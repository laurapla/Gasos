\chapter{Fractional Step Method}
The equations to be solved are the conservation of mass and the conservation of momentum:
\begin{equation}
\begin{aligned}
\nabla\cdot\vec{v}=0 \\
\rho\frac{\partial\vec{v}}{\partial t}+\rho\left(\vec{v}\cdot\nabla\right)\vec{v}=-\nabla p+\mu\nabla^{2}\vec{v}
\end{aligned}
\end{equation}
According to the Helmholtz-Hodge theorem, it is possible to decompose any vector in a divergence-free vector parallel to the boundary and a gradient field, and this decomposition is unique \cite{CTTC}.

Assuming constant density and viscosity, the convective and viscosity terms can be grouped together in a single variable $R\left(\vec{v}\right)$, rewriting the Navier-Stokes equation as:
\begin{equation}
\rho\frac{\partial\vec{v}}{\partial t}=R\left(\vec{v}\right)-\nabla p
\label{RNSFSM}
\end{equation}
where $R\left(\vec{v}\right)=-\rho\left(\vec{v}\cdot\nabla\right)\vec{v}+\mu\nabla^{2}\vec{v}$.
Integrating the equation \ref{RNSFSM} over time:
\begin{equation}
\rho\frac{\vec{v}^{n+1}-\vec{v}^{n}}{\Delta t}=R^{n+\frac{1}{2}}\left(\vec{v}\right)-\nabla p^{n+1}
\end{equation}
However, the term $R^{n+\frac{1}{2}}\left(\vec{v}\right)$ is not easy to evaluate. To do so, the Adams-Bashforth second-order scheme is used:
\begin{equation}
R^{n+\frac{1}{2}}\left(\vec{v}\right)\approx\frac{3}{2}R\left(\vec{v^{n}}\right)-\frac{1}{2}R\left(\vec{v}^{n-1}\right)
\end{equation}
Applying the Helmholtz-Hodge Theorem, the intermediate velocity is easily obtained:
\begin{equation}
\vec{v}^{P}=\vec{v}^{n+1}+\frac{\Delta t}{\rho}\nabla p^{n+1}
\label{IntermediateVelocity}
\end{equation}
Introducing this expression to the integrated equation:
\begin{equation}
\rho\frac{\vec{v}^{P}-\vec{v}^{n}}{\Delta t}=R^{n+\frac{1}{2}}\left(\vec{v}\right)
\label{IntermediatewithR}
\end{equation}
And finally, applying the divergence to the expression of the intermediate velocity $\vec{v}^{P}$ \ref{IntermediateVelocity}, the Poisson equation is obtained:
\begin{equation}
\nabla\cdot\vec{v}=\frac{\Delta t}{\rho}\nabla^{2}p
\label{Poisson}
\end{equation}

\section{Fractional Step Method algorithm}
With all these expressions the fractional step method (FSM) can be finally implemented, following the next scheme:
\begin{enumerate}
	\item Evaluate $R^{n+\frac{1}{2}}\left(\vec{v}\right)$.
	\item Calculate the intermediate velocity with equation \ref{IntermediatewithR}.
	\item Calculate the pressure $p^{n+1}$ from the Poisson equation \ref{Poisson} using a linear solver.
	\item Calculate the velocity at the next time step with equation \ref{IntermediateVelocity}.
\end{enumerate}
However, this method can be problematic if the mesh of the problem is not correctly implemented. To avoid having solutions with no physical sense, it is important to use staggered meshes or collocated meshes.

\section{Discretization}
To avoid convergence problems or incorrect solutions, the staggered meshes are used. As shown in figure \ref{staggered}, in a two-dimensional case there are 3 control volumes, one for each variable: $p_{P}$, $u_{P}$ and $v_{P}$. They are coloured in black, red and green respectively.
\begin{figure}
	\centering
	\includegraphics[scale=0.8]{DrivenCavity/staggered}
	\caption{Staggered meshes (2D)}
	\label{staggered}
\end{figure}

\subsection{Intermediate velocity discretization}
First of all, it is necessary to discretize the expression of R of the equation \ref{RNSFSM}:
\begin{equation}
R\left(\vec{v}\right)=-\rho\left(\vec{v}\cdot\nabla\right)\vec{v}+\mu\nabla^{2}\vec{v}
\end{equation}
This variable is a vector. Integrating the expression over the control volume of the horizontal velocity staggered mesh in the horizontal direction:
\begin{equation}
\int_{\Omega_{x}}R\left(u\right)d\Omega_{x}=-\int_{\Omega_{x}}\left(\rho\vec{v}\cdot\nabla\right)ud\Omega_{x}+\int_{\Omega_{x}}\mu\nabla^{2}ud\Omega_{x}
\end{equation}
Now, applying the Gauss Theorem:
\begin{equation}
R\left(u\right)V_{P}=-\int_{\partial\Omega_{x}}\left(\rho\vec{v}\right)u\cdot\vec{n}dS+\int_{\Omega_{x}}\mu\nabla^{2}u\cdot\vec{n}dS
\end{equation}
The final integration of R in the horizontal direction results as:
\begin{multline}
R\left(u\right)V_{P}=\left[\mu_{e}\frac{u_{E}-u_{P}}{d_{EP}}A_{e}+\mu_{n}\frac{u_{N}-u_{P}}{d_{NP}}A_{n}-\mu_{w}\frac{u_{P}-u_{W}}{d_{WP}}A_{w}-\mu_{s}\frac{u_{P}-u_{S}}{d_{SP}}A_{s}\right] \\
-\left[\left(\rho u\right)_{e}u_{e}A_{e}+\left(\rho v\right)_{n}u_{n}A_{n}-\left(\rho u\right)_{w}u_{w}A_{w}-\left(\rho v\right)_{s}u_{s}A_{s}\right]
\end{multline}
The main problem of this expression is the evaluation of the velocities and the mass flows in the faces of the control volume. To calculate the velocities in the faces, some of the numerical schemes previously discussed can be used: CDS, UDS... In the case of the mass flows a simple approach is used:
\begin{equation}
\left(\rho u\right)_{e}=\frac{\left(\rho u\right)_{E}+\left(\rho u\right)_{P}}{2}
\end{equation}

\subsection{Pressure discretization}
Knowing the space discretization of the domain, the discretized Poisson equation can be calculated. Integrating the expression \ref{Poisson} over the domain and applying the divergence theorem, the following expression can be easily obtained:
\begin{equation}
\begin{aligned}
\frac{p_{E}^{n+1}-p_{P}^{n+1}}{d_{EP}}A_{e}+\frac{p_{N}^{n+1}-p_{P}^{n+1}}{d_{NP}}A_{n}-\frac{p_{P}^{n+1}-p_{W}^{n+1}}{d_{WP}}A_{w}-\frac{p_{P}^{n+1}-p_{S}^{n+1}}{d_{SP}}A_{s}= \\
\frac{1}{\Delta t}\left[\left(\rho u^{P}\right)_{e}A_{e}+\left(\rho v^{P}\right)_{n}A_{n}-\left(\rho u^{P}\right)_{w}A_{w}-\left(\rho v^{P}\right)_{s}A_{s}\right]
\end{aligned}
\end{equation}
Rewriting the equation using discretization coefficients:
\begin{equation}
a_{P}p_{P}^{n+1}=a_{E}p_{E}^{n+1}+a_{W}p_{W}^{n+1}+a_{N}p_{N}^{n+1}+a_{S}p_{S}^{n+1}+b_{P}
\end{equation}
where
\begin{equation}
a_{P}=a_{E}+a_{W}+a_{N}+a_{S}
\end{equation}
\begin{equation}
a_{E}=\frac{A_{e}}{d_{EP}}
\end{equation}
\begin{equation}
a_{W}=\frac{A_{w}}{d_{WP}}
\end{equation}
\begin{equation}
a_{N}=\frac{A_{n}}{d_{NP}}
\end{equation}
\begin{equation}
a_{S}=\frac{A_{s}}{d_{SP}}
\end{equation}
\begin{equation}
b_{P}=-\frac{1}{\Delta t}\left[\left(\rho u^{P}\right)_{e}A_{e}+\left(\rho v^{P}\right)_{n}A_{n}-\left(\rho u^{P}\right)_{w}A_{w}-\left(\rho v^{P}\right)_{s}A_{s}\right]
\end{equation}